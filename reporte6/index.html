<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<title>Cliente Microservicio ‚ÄúLibros‚Äù ‚Äî XML + XSLT</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="color-scheme" content="dark light" />
		<link rel="stylesheet" href="./css/styles.css" />
	</head>
	<body>
		<header class="app-header">
			<h1>üìö Cliente Microservicio ‚ÄúLibros‚Äù (CQRS)</h1>
			<span class="pill" aria-live="polite">Config persistente</span>
		</header>

		<main class="container grid">
			<!-- Configuraci√≥n -->
			<section class="card card--cfg" aria-labelledby="cfg-title">
				<h2 id="cfg-title">1) Configurar servidor y endpoints</h2>

				<form id="cfgForm" novalidate>
					<div class="row">
						<div>
							<label for="protocol">Protocolo</label>
							<select id="protocol" name="protocol">
								<option>http</option>
								<option>https</option>
							</select>
						</div>
						<div>
							<label for="host">IP / Host</label>
							<input id="host" name="host" placeholder="172.206.106.38" required />
						</div>
					</div>

					<div class="row">
						<div>
							<label for="port">Puerto</label>
							<input id="port" name="port" type="number" placeholder="5000" />
						</div>
						<div>
							<label for="basePath">Base Path (CQRS lectura)</label>
							<!-- üîÅ Antes: /api  ‚ûú  Ahora por defecto /query -->
							<input id="basePath" name="basePath" placeholder="/query" />
						</div>
					</div>

					<label for="epAll">Endpoint QUERY: TODOS</label>
					<input id="epAll" name="epAll" placeholder="/books" />

					<label for="epIsbn">Endpoint QUERY: por ISBN (usa {isbn})</label>
					<input id="epIsbn" name="epIsbn" placeholder="/books/isbn/{isbn}" />

					<label for="epFormat">Endpoint QUERY: por Formato (usa {format})</label>
					<input id="epFormat" name="epFormat" placeholder="/books/format/{format}" />

					<label for="epAuthor">Endpoint QUERY: por Autor (usa {author})</label>
					<input id="epAuthor" name="epAuthor" placeholder="/books/author/{author}" />

					<p class="footer-note">
						Los COMMANDS (insert/update/delete) se env√≠an autom√°ticamente al path hermano
						<code>/command</code>. No hace falta configurarlo aqu√≠.
					</p>

					<div class="btns">
						<button type="submit" class="success">Guardar configuraci√≥n</button>
						<button type="button" id="loadCfg">Cargar</button>
						<button type="button" id="testPing" class="warn">Probar conexi√≥n</button>
						<button type="button" id="resetCfg" class="danger">Restablecer</button>
					</div>
				</form>

				<div id="statusCfg" class="status muted" role="status" aria-live="polite"></div>
				<p class="footer-note">Si ves errores de CORS, habil√≠talo en el micro o sirve este cliente desde el mismo host/puerto.</p>
			</section>

			<!-- Navegaci√≥n/Acciones -->
			<section class="card card--actions" aria-labelledby="actions-title">
				<h2 id="actions-title">2) Consultar y visualizar</h2>

				<form id="actionsForm" class="filters" novalidate>
					<div class="filters-row">
						<div class="field">
							<label for="isbnInput">ISBN</label>
							<div class="inline">
								<input id="isbnInput" name="isbn" placeholder="978-0307743657" />
								<button type="button" id="btnIsbn">Buscar ISBN</button>
							</div>
						</div>

						<div class="field">
							<label for="formatSelect">Formato</label>
							<div class="inline">
								<select id="formatSelect">
									<option value="">‚Äî seleccionar ‚Äî</option>
								</select>
								<button type="button" id="btnFormat">Filtrar Formato</button>
							</div>
						</div>

						<div class="field">
							<label for="authorSelect">Autor</label>
							<div class="inline">
								<select id="authorSelect">
									<option value="">‚Äî seleccionar ‚Äî</option>
								</select>
								<button type="button" id="btnAuthor">Filtrar Autor</button>
							</div>
						</div>
					</div>

					<div class="btns">
						<button type="button" id="btnAll" class="primary">Cargar TODOS</button>
						<button type="button" id="btnToggleXML" aria-expanded="false">Mostrar / Ocultar XML</button>
						<button type="button" id="btnRefreshLists">Actualizar listas (Formato/Autor)</button>
					</div>
				</form>

				<div id="statusReq" class="status muted" role="status" aria-live="polite"></div>
				<div class="results" id="renderTarget"></div>

				<details id="xmlBox">
					<summary>XML recibido</summary>
					<pre id="xmlRaw">(aqu√≠ ver√°s el XML crudo)</pre>
				</details>
			</section>

			<!-- CRUD -->
			<section class="card card--crud" aria-labelledby="crud-title">
				<h2 id="crud-title">3) Operaciones (Insertar / Actualizar / Borrar)</h2>

				<div class="crud-grid">
					<!-- INSERT -->
					<form id="formInsert" class="crud card-sub" novalidate>
						<h3>Insertar libro</h3>
						<div class="row">
							<div><label>ISBN</label><input id="insIsbn" required /></div>
							<div><label>T√≠tulo</label><input id="insTitulo" required /></div>
						</div>
						<div class="row">
							<div><label>A√±o</label><input id="insAnio" type="number" required /></div>
							<div><label>Precio</label><input id="insPrecio" type="number" step="0.01" required /></div>
						</div>
						<div class="row">
							<div><label>Stock</label><input id="insStock" type="number" required /></div>
							<div><label>G√©nero</label><input id="insGenero" placeholder="Debe existir en DB" required /></div>
						</div>
						<div class="row">
							<div><label>Formato</label><input id="insFormato" placeholder="Debe existir en DB" required /></div>
							<div><label>Autor(es)</label><input id="insAutor" placeholder="Separados por coma; deben existir" required /></div>
						</div>
						<div class="btns">
							<button type="submit" class="success">Insertar</button>
						</div>
						<div id="statusInsert" class="status muted" role="status"></div>
					</form>

					<!-- UPDATE -->
					<form id="formUpdate" class="crud card-sub" novalidate>
						<h3>Actualizar libro por ISBN</h3>
						<div class="row">
							<div><label>ISBN (target)</label><input id="updIsbn" required /></div>
							<div><label>T√≠tulo</label><input id="updTitulo" placeholder="(opcional)" /></div>
						</div>
						<div class="row">
							<div><label>A√±o</label><input id="updAnio" type="number" placeholder="(opcional)" /></div>
							<div><label>Precio</label><input id="updPrecio" type="number" step="0.01" placeholder="(opcional)" /></div>
						</div>
						<div class="row">
							<div><label>Stock</label><input id="updStock" type="number" placeholder="(opcional)" /></div>
						</div>
						<div class="btns">
							<button type="submit" class="warn">Actualizar</button>
						</div>
						<div id="statusUpdate" class="status muted" role="status"></div>
					</form>

					<!-- DELETE -->
					<form id="formDelete" class="crud card-sub" novalidate>
						<h3>Borrar libros (m√∫ltiples)</h3>
						<label for="delIsbns">ISBNs separados por coma</label>
						<textarea id="delIsbns" rows="3" placeholder="978-...,978-..."></textarea>
						<div class="btns">
							<button type="submit" class="danger">Borrar</button>
						</div>
						<div id="statusDelete" class="status muted" role="status"></div>
					</form>
				</div>
			</section>
		</main>

		<script type="module" src="./js/app.js"></script>
	</body>
</html>
